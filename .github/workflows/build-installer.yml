name: Build Installer EXE

on:
  workflow_dispatch:

jobs:
  build-installer:
    runs-on: windows-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install NSIS
      shell: pwsh
      run: |
        choco install nsis -y
        $nsis = "C:\Program Files (x86)\NSIS"
        echo "NSIS path: $nsis"
        echo "$nsis" >> $env:GITHUB_PATH

    - name: Verify makensis path
      shell: pwsh
      run: |
        Get-Command makensis.exe -ErrorAction Continue

    - name: Build Installer
      shell: pwsh
      run: |
        makensis.exe /V4 installer/installer.nsi

    - name: Upload installer
      uses: actions/upload-artifact@v4
      with:
        name: RSATDashboardInstaller
        path: installer/RSATDashboard_Setup.exe
