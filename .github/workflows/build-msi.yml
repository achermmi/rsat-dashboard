name: Build MSI Installer

on:
  workflow_dispatch:

jobs:
  build-msi:
    runs-on: windows-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install WiX Toolset 3.11
      run: choco install wix311 -y

    - name: Add WiX to PATH
      shell: pwsh
      run: |
        echo "C:\Program Files (x86)\WiX Toolset v3.11\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Build MSI
      shell: pwsh
      run: |
        candle installer\installer.wxs -o installer\installer.wixobj
        light installer\installer.wixobj -o installer\RSATDashboardSetup.msi

    - name: Upload MSI artifact
      uses: actions/upload-artifact@v3
      with:
        name: RSAT-Dashboard-MSI
        path: installer/RSATDashboardSetup.msi
