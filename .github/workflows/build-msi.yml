name: Build MSI Installer

on:
  workflow_dispatch:

jobs:
  build-msi:
    runs-on: windows-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    # Install WiX Toolset 3
    - name: Install WiX Toolset
      shell: pwsh
      run: |
        choco install wix-toolset -y
        echo "C:\Program Files (x86)\WiX Toolset v3.11\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    # Build MSI
    - name: Build MSI Installer
      shell: pwsh
      run: |
        candle installer\installer.wxs -out installer\obj\
        light installer\obj\installer.wixobj -out installer\RSATDashboardSetup.msi

    # Upload artifact
    - name: Upload MSI Artifact
      uses: actions/upload-artifact@v3
      with:
        name: RSAT-Dashboard-MSI
        path: installer/RSATDashboardSetup.msi
