name: Build MSI Installer

on:
  workflow_dispatch:

jobs:
  build-msi:
    runs-on: windows-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Download WiX Toolset 3.14
      shell: pwsh
      run: |
        Invoke-WebRequest -Uri "https://github.com/wixtoolset/wix3/releases/download/wix314rtm/wix314-binaries.zip" -OutFile "wix.zip"
        Expand-Archive -Path "wix.zip" -DestinationPath "C:\wix" -Force

    - name: Add WiX to PATH
      shell: pwsh
      run: |
        echo "C:\wix" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Build MSI using candle/light
      shell: pwsh
      run: |
        candle installer\installer.wxs -o installer\setup.wixobj
        light installer\setup.wixobj -o installer\RSATDashboardSetup.msi

    - name: Upload MSI artifact
      uses: actions/upload-artifact@v3
      with:
        name: RSAT-Dashboard-MSI
        path: installer/RSATDashboardSetup.msi
